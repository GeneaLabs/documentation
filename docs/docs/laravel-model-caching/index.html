<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Building a navigation menu for your site">

        <meta property="og:site_name" content=""/>
        <meta property="og:title" content="Model Caching for Laravel | "/>
        <meta property="og:description" content="Building a navigation menu for your site"/>
        <meta property="og:url" content="https://genealabs.com/docs/laravel-model-caching"/>
        <meta property="og:image" content="/assets/images/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="">
        <meta name="twitter:card" content="summary_large_image">

        
        <title> | Model Caching for Laravel</title>

        <link rel="home" href="https://genealabs.com">
        <link rel="icon" href="/favicon.ico">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=fd0d3e296830fe5c6214">

        
            </head>

    <body class="flex flex-col justify-between min-h-screen bg-grey-lightest text-grey-darkest leading-normal font-sans">
        <div id="app">
            <header class="flex items-center shadow bg-white border-b h-24 mb-8 py-4" role="banner">
                <div class="container flex items-center max-w-4xl mx-auto px-4 lg:px-8">
                    <div class="flex items-center">
                        <a href="/" title=" home" class="inline-flex items-center">
                            <img class="h-8 md:h-10 mr-3" src="/assets/images/genealabs_logo_new.png" alt=" logo" />

                            <h1 class="text-lg md:text-2xl text-blue-darkest font-semibold hover:text-blue-dark my-0 pr-4"></h1>
                        </a>
                    </div>

                        <div class="flex flex-1 justify-end items-center text-right md:pl-10">
        
        <nav class="hidden lg:flex items-center justify-end text-lg">
            <a href="/blog"
            class="lvl0   ml-6 "
        >
            Blog
        </a>
    
                <a href="/packages"
            class="lvl0   ml-6 "
        >
            Packages
        </a>
    
                <a href="/about"
            class="lvl0   ml-6 "
        >
            About
        </a>
    
                <a href="/contact"
            class="lvl0   ml-6 "
        >
            Contact
        </a>
    
        </nav>
    </div>

                </div>

                    <button class="flex justify-center items-center bg-blue border border-blue h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

            </header>

            <main role="main"
                class="w-full flex-auto relative"
            >
                    <section class="container max-w-4xl mx-auto px-6 md:px-8 py-4">
        <div class="flex flex-col lg:flex-row">
            <nav id="js-nav-menu" class="nav-menu hidden lg:block">
                <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/packages"
            class="lvl0 lvl0-active  nav-menu__item hover:text-blue"
        >
            Packages
        </a>
    
            
        <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/docs/laravel-model-caching"
            class="lvl1  active font-semibold text-blue nav-menu__item hover:text-blue"
        >
            Model Caching for Laravel
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/laravel-caffeine"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Caffeine for Laravel
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/laravel-governor"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Governor for Laravel
        </a>
    
    </li>
    </ul>
    </li>
    </ul>
            </nav>

            <div class="w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
                <h1>Model Caching for Laravel</h1>
<p><a href="https://travis-ci.org/GeneaLabs/laravel-model-caching"><img src="https://img.shields.io/travis/GeneaLabs/laravel-model-caching/master.svg" alt="Travis" /></a>
<a href="https://scrutinizer-ci.com/g/GeneaLabs/laravel-model-caching"><img src="https://img.shields.io/scrutinizer/g/GeneaLabs/laravel-model-caching/master.svg" alt="Scrutinizer" /></a>
<img src="https://bettercodehub.com/edge/badge/GeneaLabs/laravel-model-caching?branch=master" alt="BCH Compliance" />
<a href="https://coveralls.io/github/GeneaLabs/laravel-model-caching"><img src="https://img.shields.io/coveralls/GeneaLabs/laravel-model-caching/master.svg" alt="Coveralls" /></a>
<a href="https://github.com/GeneaLabs/laravel-model-caching"><img src="https://img.shields.io/github/release/GeneaLabs/laravel-model-caching/all.svg" alt="GitHub (pre-)release" /></a>
<a href="https://packagist.org/packages/genealabs/laravel-model-caching"><img src="https://img.shields.io/packagist/dt/GeneaLabs/laravel-model-caching.svg" alt="Packagist" /></a>
<a href="https://raw.githubusercontent.com/GeneaLabs/laravel-model-caching/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="GitHub license" /></a></p>
<p><img src="https://user-images.githubusercontent.com/1791050/30768358-0df9d0f2-9fbb-11e7-9f10-ad40b83bbf59.jpg" alt="pexels-photo-325229" /></p>
<h2>Supporting This Package</h2>
<p>This is an MIT-licensed open source project with its ongoing development made possible by the support of the community. If you'd like to support this, and our other packages, please consider <a href="https://www.patreon.com/mikebronner">becoming a backer or sponsor on Patreon</a>.</p>
<h2>Impetus</h2>
<p>I created this package in response to a client project that had complex, nested
forms with many <code>&lt;select&gt;</code>'s that resulted in over 700 database queries on one
page. I needed a package that abstracted the caching process out of the model
for me, and one that would let me cache custom queries, as well as cache model
relationships. This package is an attempt to address those requirements.</p>
<h2>Features</h2>
<ul>
<li>automatic, self-invalidating relationship (only eager-loading) caching.</li>
<li>automatic, self-invalidating model query caching.</li>
<li>automatic use of cache tags for cache providers that support them (will
flush entire cache for providers that don't).</li>
</ul>
<h2>Requirements</h2>
<ul>
<li>PHP &gt;= 7.1.3</li>
<li>Laravel 5.8
<pre><code class="language-diff">- Please note that prior Laravel versions are not supported and the package
- versions that are compatible with prior versions of Laravel contain bugs.
- Please only use with the versions of Laravel noted above to be compatible.</code></pre></li>
</ul>
<h3>Possible Conflicting Packages</h3>
<p>Any packages that also override <code>newEloquentModel()</code> from the <code>Model</code> class will
likely conflict with this package. So far these may include the following:</p>
<ul>
<li><a href="https://github.com/grimzy/laravel-mysql-spatial">grimzy/laravel-mysql-spatial</a></li>
<li><a href="https://github.com/fico7489/laravel-pivot">fico7489/laravel-pivot</a>
This package conflicts with Laravel Telescope. We have forked our own solution
for pivot events that replaces this package. If you previously had this package
installed, we recommend uninstalling it to avoid conflicts.</li>
<li><a href="https://github.com/chelout/laravel-relationship-events">chelout/laravel-relationship-events</a></li>
</ul>
<h3>Things That Don't Work Currently</h3>
<p>The following items currently do no work with this package:</p>
<pre><code class="language-diff">- caching of lazy-loaded relationships, see #127. Currently lazy-loaded belongs-to relationships are cached. Caching of other relationships is in the works.
- using select() clauses in Eloquent queries, see #238 (work-around discussed in the issue)</code></pre>
<p><a href="https://vimeo.com/256318402"><img src="https://user-images.githubusercontent.com/1791050/36356190-fc1982b2-14a2-11e8-85ed-06f8e3b57ae8.png" alt="installation guide cover" /></a></p>
<h2>Installation</h2>
<p>Be sure to not require a specific version of this package when requiring it:</p>
<pre><code>composer require genealabs/laravel-model-caching:*</code></pre>
<h2>Upgrade Notes</h2>
<h3>0.5.0</h3>
<p>The following implementations have changed (see the respective sections below):</p>
<ul>
<li>model-specific cache prefix</li>
</ul>
<h2>Configuration</h2>
<h3>Recommended (Optional) Custom Cache Store</h3>
<p>If you would like to use a different cache store than the default one used by
your Laravel application, you may do so by setting the <code>MODEL_CACHE_STORE</code>
environment variable in your <code>.env</code> file to the name of a cache store configured
in <code>config/cache.php</code> (you can define any custom cache store based on your
specific needs there). For example:</p>
<pre><code>MODEL_CACHE_STORE=redis2</code></pre>
<h2>Usage</h2>
<p>For best performance a taggable cache provider is recommended (redis,
memcached). While this is optional, using a non-taggable cache provider will
mean that the entire cache is cleared each time a model is created, saved,
updated, or deleted.</p>
<p>For ease of maintenance, I would recommend adding a <code>BaseModel</code> model that
uses <code>Cachable</code>, from which all your other models are extended. If you
don't want to do that, simply extend your models directly from <code>CachedModel</code>.</p>
<p>Here's an example <code>BaseModel</code> class:</p>
<pre><code class="language-php">&lt;?php namespace App;

use GeneaLabs\LaravelModelCaching\Traits\Cachable;

abstract class BaseModel
{
    use Cachable;
    //
}</code></pre>
<h3>Multiple Database Connections</h3>
<p><strong>Thanks to @dtvmedia for suggestion this feature. This is actually a more robust
solution than cache-prefixes.</strong></p>
<p>Keeping keys separate for multiple database connections is automatically handled.
This is especially important for multi-tenant applications, and of course any
application using multiple database connections.</p>
<h3>Optional Cache Key Prefix</h3>
<p>Thanks to @lucian-dragomir for suggesting this feature! You can use cache key
prefixing to keep cache entries separate for multi-tenant applications. For this
it is recommended to add the Cachable trait to a base model, then set the cache
key prefix config value there.</p>
<p>Here's is an example:</p>
<pre><code class="language-php">&lt;?php namespace GeneaLabs\LaravelModelCaching\Tests\Fixtures;

use GeneaLabs\LaravelModelCaching\Traits\Cachable;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class BaseModel extends Model
{
    use Cachable;

    protected $cachePrefix = "test-prefix";
}</code></pre>
<p>The cache prefix can also be set in the configuration to prefix all cached
models across the board:</p>
<pre><code class="language-php">    'cache-prefix' =&gt; 'test-prefix',</code></pre>
<h3>Exception: User Model</h3>
<p>I would not recommend caching the user model, as it is a special case, since it
extends <code>Illuminate\Foundation\Auth\User</code>. Overriding that would break functionality.
Not only that, but it probably isn't a good idea to cache the user model anyway,
since you always want to pull the most up-to-date info on it.</p>
<h3>Experimental: Cache Cool-down In Specific Models</h3>
<p>In some instances, you may want to add a cache invalidation cool-down period.
For example you might have a busy site where comments are submitted at a high
rate, and you don't want every comment submission to invalidate the cache. While
I don't necessarily recommend this, you might experiment it's effectiveness.</p>
<p>To use it, it must be enabled in the model (or base model if you want to use it on multiple or all models):</p>
<pre><code class="language-php">class MyModel extends Model
{
    use Cachable;

    protected $cacheCooldownSeconds = 300; // 5 minutes

    // ...
}</code></pre>
<p>After that it can be implemented in queries:</p>
<pre><code class="language-php">(new Comment)
    -&gt;withCacheCooldownSeconds(30) // override default cooldown seconds in model
    -&gt;get();</code></pre>
<p>or:</p>
<pre><code class="language-php">(new Comment)
    -&gt;withCacheCooldownSeconds() // use default cooldown seconds in model
    -&gt;get();</code></pre>
<h3>Disabling Caching of Queries</h3>
<p>There are two methods by which model-caching can be disabled:</p>
<ol>
<li>Use <code>-&gt;disableCache()</code> in a query-by-query instance.</li>
<li>Set <code>MODEL_CACHE_DISABLED=TRUE</code> in your <code>.env</code> file.</li>
<li>If you only need to disable the cache for a block of code, or for non-
eloquent queries, this is probably the better option:
<pre><code class="language-php">$result = app("model-cache")-&gt;runDisabled(function () {
    return (new MyModel)-&gt;get(); // or any other stuff you need to run with model-caching disabled
});</code></pre></li>
</ol>
<p><strong>Recommendation: use option #1 in all your seeder queries to avoid pulling in
cached information when reseeding multiple times.</strong>
You can disable a given query by using <code>disableCache()</code> anywhere in the query chain. For example:</p>
<pre><code class="language-php">$results = $myModel-&gt;disableCache()-&gt;where('field', $value)-&gt;get();</code></pre>
<h3>Manual Flushing of Specific Model</h3>
<p>You can flush the cache of a specific model using the following artisan command:</p>
<pre><code class="language-sh">php artisan modelCache:clear --model=App\Model</code></pre>
<p>This comes in handy when manually making updates to the database. You could also
trigger this after making updates to the database from sources outside your
Laravel app.</p>
<h2>Summary</h2>
<p><strong>That's all you need to do. All model queries and relationships are now
cached!</strong></p>
<p>In testing this has optimized performance on some pages up to 900%! Most often
you should see somewhere around 100% performance increase.</p>
<h2>Commitment to Quality</h2>
<p>During package development I try as best as possible to embrace good design and development practices, to help ensure that this package is as good as it can
be. My checklist for package development includes:</p>
<ul>
<li>✅ Achieve as close to 100% code coverage as possible using unit tests.</li>
<li>✅ Eliminate any issues identified by SensioLabs Insight and Scrutinizer.</li>
<li>✅ Be fully PSR1, PSR2, and PSR4 compliant.</li>
<li>✅ Include comprehensive documentation in README.md.</li>
<li>✅ Provide an up-to-date CHANGELOG.md which adheres to the format outlined
at <a href="https://keepachangelog.com">https://keepachangelog.com</a>.</li>
<li>✅ Have no PHPMD or PHPCS warnings throughout all code.</li>
</ul>
<h2>Contributing</h2>
<p>Please observe and respect all aspects of the included Code of Conduct <a href="https://github.com/GeneaLabs/laravel-model-caching/blob/master/CODE_OF_CONDUCT.md">https://github.com/GeneaLabs/laravel-model-caching/blob/master/CODE_OF_CONDUCT.md</a>.</p>
<h3>Reporting Issues</h3>
<p>When reporting issues, please fill out the included template as completely as
possible. Incomplete issues may be ignored or closed if there is not enough
information included to be actionable.</p>
<h3>Submitting Pull Requests</h3>
<p>Please review the Contribution Guidelines <a href="https://github.com/GeneaLabs/laravel-model-caching/blob/master/CONTRIBUTING.md">https://github.com/GeneaLabs/laravel-model-caching/blob/master/CONTRIBUTING.md</a>.
Only PRs that meet all criterium will be accepted.</p>
<h2>If you ❤️ open-source software, give the repos you use a ⭐️.</h2>
<p>We have included the awesome <code>symfony/thanks</code> composer package as a dev
dependency. Let your OS package maintainers know you appreciate them by starring
the packages you use. Simply run composer thanks after installing this package.
(And not to worry, since it's a dev-dependency it won't be installed in your
live environment.)</p>            </div>
        </div>
    </section>
            </main>
        </div>

        <script src="/assets/build/js/main.js?id=a6f070e792abfcf8ab6d"></script>

        <script>
    const navMenu = {
        toggle() {
            let menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
            console.log(document.getElementById('js-nav-menu2'));
            //document.querySelector("js-nav-menu")
/*
            const menu2 = document.getElementById('js-nav-menu2');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
            */
        },
    }
</script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-reset">
                <li class="md:mr-2">
                    &copy; <a href="https://genealabs.com" title="GeneaLabs website">GeneaLabs</a> 2019.
                </li>
            </ul>
        </footer>
    </body>
</html>
